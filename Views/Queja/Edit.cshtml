@model Queja

@{
    ViewData["Title"] = "Editar Queja";
}

<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <h1 class="mb-4">Editar Queja</h1>

            <form method="post" asp-action="Edit" class="needs-validation" novalidate>
                <input type="hidden" asp-for="Id" />
                <input type="hidden" asp-for="FechaCreacion" />

                <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                <!-- Seleccionar Reserva -->
                <div class="mb-3">
                    <label asp-for="ReservaId" class="form-label">Reserva *</label>
                    <select asp-for="ReservaId" class="form-select" required>
                        <option value="">-- Seleccionar Reserva --</option>
                        @{
                            var reservas = ViewData["ReservaId"] as List<dynamic> ?? new();
                        }
                        @foreach (var reserva in reservas)
                        {
                            <option value="@reserva.Id" selected="@(reserva.Id == Model.ReservaId)">
                                @reserva.Cliente?.Nombre - @reserva.Servicio?.Nombre - @reserva.FechaHora.ToString("dd/MM/yyyy HH:mm")
                            </option>
                        }
                    </select>
                    <span asp-validation-for="ReservaId" class="text-danger"></span>
                </div>

                <!-- Cliente (lectura) -->
                <div class="mb-3">
                    <label asp-for="ClienteId" class="form-label">Cliente</label>
                    <select asp-for="ClienteId" class="form-select" disabled>
                        @{
                            var clientes = ViewData["ClienteId"] as List<dynamic> ?? new();
                        }
                        @foreach (var cliente in clientes)
                        {
                            <option value="@cliente.Id" selected="@(cliente.Id == Model.ClienteId)">@cliente.Nombre</option>
                        }
                    </select>
                </div>

                <!-- Servicio (lectura) -->
                <div class="mb-3">
                    <label asp-for="ServicioId" class="form-label">Servicio</label>
                    <select asp-for="ServicioId" class="form-select" disabled>
                        @{
                            var servicios = ViewData["ServicioId"] as List<dynamic> ?? new();
                        }
                        @foreach (var servicio in servicios)
                        {
                            <option value="@servicio.Id" selected="@(servicio.Id == Model.ServicioId)">@servicio.Nombre</option>
                        }
                    </select>
                </div>

                <!-- Título -->
                <div class="mb-3">
                    <label asp-for="Titulo" class="form-label">Título de la Queja *</label>
                    <input asp-for="Titulo" class="form-control" required maxlength="500" />
                    <span asp-validation-for="Titulo" class="text-danger"></span>
                </div>

                <!-- Descripción -->
                <div class="mb-3">
                    <label asp-for="Descripcion" class="form-label">Descripción Detallada *</label>
                    <textarea asp-for="Descripcion" class="form-control" rows="5" required maxlength="2000"></textarea>
                    <small class="form-text text-muted">Máximo 2000 caracteres</small>
                    <span asp-validation-for="Descripcion" class="text-danger"></span>
                </div>

                <!-- Calificación -->
                <div class="mb-3">
                    <label asp-for="Calificacion" class="form-label">Calificación del Servicio *</label>
                    <div class="btn-group-vertical w-100" role="group">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" asp-for="Calificacion" value="1" id="cal1" />
                            <label class="form-check-label" for="cal1">
                                ⭐ Muy Insatisfecho (1)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" asp-for="Calificacion" value="2" id="cal2" />
                            <label class="form-check-label" for="cal2">
                                ⭐⭐ Insatisfecho (2)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" asp-for="Calificacion" value="3" id="cal3" />
                            <label class="form-check-label" for="cal3">
                                ⭐⭐⭐ Normal (3)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" asp-for="Calificacion" value="4" id="cal4" />
                            <label class="form-check-label" for="cal4">
                                ⭐⭐⭐⭐ Satisfecho (4)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" asp-for="Calificacion" value="5" id="cal5" />
                            <label class="form-check-label" for="cal5">
                                ⭐⭐⭐⭐⭐ Muy Satisfecho (5)
                            </label>
                        </div>
                    </div>
                    <span asp-validation-for="Calificacion" class="text-danger"></span>
                </div>

                <!-- Estado -->
                <div class="mb-3">
                    <label asp-for="Estado" class="form-label">Estado</label>
                    <select asp-for="Estado" class="form-select">
                        <option value="Pendiente" selected="@(Model.Estado == "Pendiente")">Pendiente</option>
                        <option value="En Revisión" selected="@(Model.Estado == "En Revisión")">En Revisión</option>
                        <option value="Resuelta" selected="@(Model.Estado == "Resuelta")">Resuelta</option>
                    </select>
                    <span asp-validation-for="Estado" class="text-danger"></span>
                </div>

                <!-- Botones -->
                <div class="mb-3 d-grid gap-2 d-md-flex justify-content-md-end">
                    <a asp-action="Index" class="btn btn-secondary">Cancelar</a>
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
